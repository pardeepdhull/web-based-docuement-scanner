<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Medical Details - Web-Based Document Scanner &amp; OCR</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìÑ</text></svg>">
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen" class="login-screen">
        <div class="login-container">
            <div class="login-header">
                <span class="login-logo">üìÑ</span>
                <h1>My Medical Details</h1>
                <p>Web-Based Document Scanner &amp; OCR</p>
            </div>
            <form id="login-form" class="login-form">
                <div class="form-group">
                    <label for="login-username">Username</label>
                    <input type="text" id="login-username" class="form-input" placeholder="Enter your username" autocomplete="username" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" class="form-input" placeholder="Enter your password" autocomplete="current-password" required>
                </div>
                <div id="login-error" class="login-error hidden"></div>
                <button type="submit" class="btn btn-primary btn-block" id="login-btn">
                    <span class="btn-text">Log In</span>
                </button>
            </form>
            <div class="login-footer">
                <p>Demo credentials: <strong>admin</strong> / <strong>admin123</strong></p>
                <p class="auth-switch">Don't have an account? <a href="#" id="show-register-link">Sign Up</a></p>
            </div>
        </div>
    </div>

    <!-- Registration Screen -->
    <div id="register-screen" class="login-screen hidden">
        <div class="login-container">
            <div class="login-header">
                <span class="login-logo">üìÑ</span>
                <h1>My Medical Details</h1>
                <p>Create Your Account</p>
            </div>
            <form id="register-form" class="login-form">
                <div class="form-group">
                    <label for="register-username">Username</label>
                    <input type="text" id="register-username" class="form-input" placeholder="Choose a username" autocomplete="username" required>
                </div>
                <div class="form-group">
                    <label for="register-password">Password</label>
                    <input type="password" id="register-password" class="form-input" placeholder="Choose a password" autocomplete="new-password" required>
                </div>
                <div class="form-group">
                    <label for="register-password-confirm">Confirm Password</label>
                    <input type="password" id="register-password-confirm" class="form-input" placeholder="Confirm your password" autocomplete="new-password" required>
                </div>
                <div id="register-error" class="login-error hidden"></div>
                <button type="submit" class="btn btn-primary btn-block" id="register-btn">
                    <span class="btn-text">Sign Up</span>
                </button>
            </form>
            <div class="login-footer">
                <p class="auth-switch">Already have an account? <a href="#" id="show-login-link">Log In</a></p>
            </div>
        </div>
    </div>

    <!-- Main App Container (hidden until authenticated) -->
    <div id="app-container" class="app-container hidden">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="nav-brand">
                <span class="logo">üìÑ</span>
                <span class="brand-name">My Medical Details</span>
            </div>
            <div class="nav-links">
                <button class="nav-btn active" data-view="medications">
                    <span class="nav-icon">üíä</span>
                    <span class="nav-text">My Medication List</span>
                </button>
                <button class="nav-btn" data-view="appointments">
                    <span class="nav-icon">üìÖ</span>
                    <span class="nav-text">Appointments</span>
                </button>
                <button class="nav-btn" data-view="documents">
                    <span class="nav-icon">üìÅ</span>
                    <span class="nav-text">My Documents</span>
                </button>
                <button class="nav-btn" data-view="scan">
                    <span class="nav-icon">üì∑</span>
                    <span class="nav-text">Add Documents</span>
                </button>
                <button class="nav-btn hidden" id="user-management-nav-btn" data-view="users">
                    <span class="nav-icon">üë•</span>
                    <span class="nav-text">User Management</span>
                </button>
            </div>
            <div class="nav-user">
                <span class="user-greeting" id="user-greeting">Welcome, <span id="current-username">User</span></span>
                <button class="btn btn-secondary btn-sm" id="logout-btn">
                    <span class="nav-icon">üö™</span>
                    <span class="nav-text">Log Out</span>
                </button>
            </div>
        </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Scan View -->
        <section id="scan-view" class="view">
            <div class="view-header">
                <h1>Add Document</h1>
                <p>Scan a document using your camera or upload an existing image</p>
            </div>
            
            <div class="scan-options">
                <div class="option-card" id="camera-option">
                    <div class="option-icon">üì∑</div>
                    <h3>Use Camera</h3>
                    <p>Scan document using your device camera</p>
                    <button class="btn btn-primary" id="start-camera-btn">Start Camera</button>
                </div>
                
                <div class="option-card" id="upload-option">
                    <div class="option-icon">üì§</div>
                    <h3>Upload File</h3>
                    <p>Upload an existing image file</p>
                    <input type="file" id="file-input" accept="image/*,.pdf" hidden>
                    <button class="btn btn-secondary" id="upload-btn">Choose File</button>
                </div>

                <div class="option-card" id="text-page-option">
                    <div class="option-icon">üìù</div>
                    <h3>Create Text Page</h3>
                    <p>Create a new text document manually</p>
                    <button class="btn btn-primary" id="create-text-btn">Create Text Page</button>
                </div>
            </div>

            <!-- Camera Container -->
            <div id="camera-container" class="camera-container hidden">
                <div class="camera-header">
                    <h3>Camera Preview</h3>
                    <button class="btn-icon" id="close-camera-btn" title="Close Camera">‚úï</button>
                </div>
                <div class="video-wrapper">
                    <video id="camera-video" autoplay playsinline></video>
                    <canvas id="capture-canvas" hidden></canvas>
                </div>
                <div class="camera-controls">
                    <button class="btn btn-primary btn-lg" id="capture-btn">
                        <span class="capture-icon">üì∏</span> Capture
                    </button>
                </div>
            </div>

            <!-- Image Preview -->
            <div id="preview-container" class="preview-container hidden">
                <div class="preview-header">
                    <h3>Document Preview</h3>
                    <button class="btn-icon" id="close-preview-btn" title="Cancel">‚úï</button>
                </div>
                <div class="preview-image-wrapper">
                    <img id="preview-image" src="" alt="Document Preview">
                </div>
                <div class="preview-form">
                    <div class="form-group">
                        <label for="doc-name">Document Name</label>
                        <input type="text" id="doc-name" placeholder="Enter document name" class="form-input">
                    </div>
                    <div class="preview-actions">
                        <button class="btn btn-secondary" id="retake-btn">Retake</button>
                        <button class="btn btn-primary" id="save-scan-btn">
                            <span class="btn-loader hidden"></span>
                            <span class="btn-text">Save &amp; Process OCR</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Text Page Editor -->
            <div id="text-editor-container" class="text-editor-container hidden">
                <div class="text-editor-header">
                    <h3>Create Text Page</h3>
                    <button class="btn-icon" id="close-text-editor-btn" title="Cancel">‚úï</button>
                </div>
                <div class="text-editor-form">
                    <div class="form-group">
                        <label for="text-page-name">Page Title</label>
                        <input type="text" id="text-page-name" placeholder="Enter page title" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="text-page-content">Content</label>
                        <textarea id="text-page-content" class="form-textarea" placeholder="Type or paste your text content here..." rows="12"></textarea>
                    </div>
                    <div class="text-editor-actions">
                        <button class="btn btn-secondary" id="cancel-text-page-btn">Cancel</button>
                        <button class="btn btn-primary" id="save-text-page-btn">
                            <span class="btn-text">Save Text Page</span>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Documents View -->
        <section id="documents-view" class="view">
            <div class="view-header">
                <h1>My Documents</h1>
                <p>View and manage your scanned documents</p>
            </div>
            
            <div class="documents-toolbar">
                <div class="search-box">
                    <span class="search-icon">üîç</span>
                    <input type="text" id="search-input" placeholder="Search documents..." class="search-input">
                </div>
                <div class="filter-options">
                    <select id="sort-select" class="form-select">
                        <option value="date-desc">Newest First</option>
                        <option value="date-asc">Oldest First</option>
                        <option value="name-asc">Name (A-Z)</option>
                        <option value="name-desc">Name (Z-A)</option>
                    </select>
                </div>
            </div>

            <div id="documents-grid" class="documents-grid">
                <!-- Documents will be dynamically inserted here -->
            </div>

            <div id="no-documents" class="no-documents hidden">
                <div class="empty-icon">üìÑ</div>
                <h3>No Documents Yet</h3>
                <p>Start by scanning or uploading your first document</p>
                <button class="btn btn-primary" id="go-scan-btn">Scan Document</button>
            </div>
        </section>

        <!-- Appointments View -->
        <section id="appointments-view" class="view">
            <div class="view-header">
                <h1>My Appointments</h1>
                <p>Manage your appointments and schedule</p>
            </div>
            
            <div class="appointments-toolbar">
                <div class="calendar-view-selector">
                    <button class="view-toggle-btn active" data-calendar-view="month">Month</button>
                    <button class="view-toggle-btn" data-calendar-view="week">Week</button>
                    <button class="view-toggle-btn" data-calendar-view="day">Day</button>
                </div>
                <button class="btn btn-primary" id="add-appointment-btn">
                    <span class="nav-icon">‚ûï</span> Add Appointment
                </button>
            </div>

            <div class="calendar-navigation">
                <button class="btn btn-secondary btn-sm" id="prev-period-btn">‚Äπ Previous</button>
                <h2 id="current-period" class="current-period">December 2025</h2>
                <button class="btn btn-secondary btn-sm" id="next-period-btn">Next ‚Ä∫</button>
                <button class="btn btn-secondary btn-sm" id="today-btn">Today</button>
            </div>

            <div class="calendar-container">
                <!-- Month View -->
                <div id="month-calendar" class="calendar-view active">
                    <div class="calendar-weekdays">
                        <div class="weekday">Sun</div>
                        <div class="weekday">Mon</div>
                        <div class="weekday">Tue</div>
                        <div class="weekday">Wed</div>
                        <div class="weekday">Thu</div>
                        <div class="weekday">Fri</div>
                        <div class="weekday">Sat</div>
                    </div>
                    <div id="calendar-grid" class="calendar-grid">
                        <!-- Calendar days will be dynamically inserted here -->
                    </div>
                </div>

                <!-- Week View -->
                <div id="week-calendar" class="calendar-view">
                    <div id="week-grid" class="week-grid">
                        <!-- Week view will be dynamically inserted here -->
                    </div>
                </div>

                <!-- Day View -->
                <div id="day-calendar" class="calendar-view">
                    <div id="day-grid" class="day-grid">
                        <!-- Day view will be dynamically inserted here -->
                    </div>
                </div>
            </div>

            <div class="appointments-list-section">
                <h3>Upcoming Appointments</h3>
                <div id="appointments-list" class="appointments-list">
                    <!-- Appointments will be dynamically inserted here -->
                </div>
                <div id="no-appointments" class="no-documents hidden">
                    <div class="empty-icon">üìÖ</div>
                    <h3>No Appointments Yet</h3>
                    <p>Start by adding your first appointment</p>
                    <button class="btn btn-primary" id="add-appointment-btn-2">Add Appointment</button>
                </div>
            </div>
        </section>

        <!-- Medications View -->
        <section id="medications-view" class="view active">
            <div class="view-header">
                <h1>My Medication List</h1>
                <p>Manage your medications and dosages</p>
            </div>
            
            <div class="medications-toolbar">
                <div class="search-box">
                    <span class="search-icon">üîç</span>
                    <input type="text" id="medication-search-input" placeholder="Search medications..." class="search-input">
                </div>
                <button class="btn btn-primary" id="add-medication-btn">
                    <span class="nav-icon">‚ûï</span> Add Medication
                </button>
            </div>

            <div id="medications-list" class="medications-list">
                <!-- Medications will be dynamically inserted here -->
            </div>

            <div id="no-medications" class="no-documents hidden">
                <div class="empty-icon">üíä</div>
                <h3>No Medications Yet</h3>
                <p>Start by adding your first medication</p>
                <button class="btn btn-primary" id="add-medication-btn-2">Add Medication</button>
            </div>
        </section>

        <!-- User Management View (Admin Only) -->
        <section id="users-view" class="view">
            <div class="view-header">
                <h1>User Management</h1>
                <p>Manage user accounts and permissions</p>
            </div>
            
            <div class="users-container">
                <div id="users-list" class="users-list">
                    <!-- Users will be dynamically inserted here -->
                </div>
            </div>

            <div id="no-users" class="no-documents hidden">
                <div class="empty-icon">üë•</div>
                <h3>No Other Users</h3>
                <p>You are currently the only user in the system</p>
            </div>
        </section>

        <!-- Appointment Modal -->
        <div id="appointment-modal" class="modal hidden">
            <div class="modal-content appointment-modal-content">
                <div class="modal-header">
                    <h2 id="appointment-modal-title">Add Appointment</h2>
                    <button class="btn-icon modal-close" id="close-appointment-modal-btn" title="Close">‚úï</button>
                </div>
                <form id="appointment-form" class="appointment-form">
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="appointment-title">Title *</label>
                            <input type="text" id="appointment-title" class="form-input" placeholder="Enter appointment title" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="appointment-date">Date *</label>
                                <input type="date" id="appointment-date" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label for="appointment-time">Time *</label>
                                <input type="time" id="appointment-time" class="form-input" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="appointment-location">Location</label>
                            <input type="text" id="appointment-location" class="form-input" placeholder="Enter location (optional)">
                        </div>
                        <div class="form-group">
                            <label for="appointment-category">Category</label>
                            <input type="text" id="appointment-category" class="form-input" placeholder="e.g., Meeting, Personal, Medical" list="category-suggestions">
                            <datalist id="category-suggestions">
                                <option value="Meeting">
                                <option value="Personal">
                                <option value="Medical">
                                <option value="Business">
                                <option value="Social">
                            </datalist>
                        </div>
                        <div class="form-group">
                            <label for="appointment-description">Description/Notes</label>
                            <textarea id="appointment-description" class="form-textarea" placeholder="Enter description or notes (optional)" rows="4"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="appointment-reminder">Reminder</label>
                            <select id="appointment-reminder" class="form-select">
                                <option value="none">No reminder</option>
                                <option value="on-day">On the day</option>
                                <option value="1-day-before">1 day before</option>
                                <option value="2-days-before">2 days before</option>
                                <option value="1-week-before">1 week before</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" id="cancel-appointment-btn">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="save-appointment-btn">
                            <span class="btn-text">Save Appointment</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Medication Modal -->
        <div id="medication-modal" class="modal hidden">
            <div class="modal-content medication-modal-content">
                <div class="modal-header">
                    <h2 id="medication-modal-title">Add Medication</h2>
                    <button class="btn-icon modal-close" id="close-medication-modal-btn" title="Close">‚úï</button>
                </div>
                <form id="medication-form" class="medication-form">
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="medication-name">Medication Name *</label>
                            <input type="text" id="medication-name" class="form-input" placeholder="Enter medication name" required>
                        </div>
                        <div class="form-group">
                            <label for="medication-dose">Dose *</label>
                            <input type="text" id="medication-dose" class="form-input" placeholder="e.g., 500mg, 2 tablets" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="medication-start-date">Start Date *</label>
                                <input type="date" id="medication-start-date" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label for="medication-stop-date">Stop Date</label>
                                <input type="date" id="medication-stop-date" class="form-input">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="medication-notes">Notes</label>
                            <textarea id="medication-notes" class="form-textarea" placeholder="Enter any notes or instructions (optional)" rows="4"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" id="cancel-medication-btn">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="save-medication-btn">
                            <span class="btn-text">Save Medication</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Document Viewer Modal -->
        <div id="viewer-modal" class="modal hidden">
            <div class="modal-content viewer-modal-content">
                <div class="modal-header">
                    <h2 id="viewer-title">Document Viewer</h2>
                    <button class="btn-icon modal-close" id="close-viewer-btn" title="Close">‚úï</button>
                </div>
                <div class="viewer-tabs">
                    <button class="tab-btn active" data-tab="image">Document</button>
                    <button class="tab-btn" data-tab="text">Extracted Text</button>
                    <button class="tab-btn" data-tab="split">Split View</button>
                </div>
                <div class="viewer-content">
                    <!-- Image View -->
                    <div id="image-tab" class="tab-content active">
                        <div class="image-viewer">
                            <img id="viewer-image" src="" alt="Document">
                        </div>
                    </div>
                    <!-- Text View -->
                    <div id="text-tab" class="tab-content">
                        <div class="text-viewer">
                            <div class="text-toolbar">
                                <button class="btn btn-sm" id="edit-text-btn" title="Edit Text">‚úèÔ∏è Edit</button>
                                <button class="btn btn-sm" id="copy-text-btn" title="Copy to Clipboard">üìã Copy</button>
                                <button class="btn btn-sm" id="download-text-btn" title="Download Text">‚¨áÔ∏è Download</button>
                            </div>
                            <div id="text-content" class="text-content" contenteditable="false"></div>
                        </div>
                    </div>
                    <!-- Split View -->
                    <div id="split-tab" class="tab-content">
                        <div class="split-viewer">
                            <div class="split-pane image-pane">
                                <img id="split-image" src="" alt="Document">
                            </div>
                            <div class="split-pane text-pane">
                                <div id="split-text-content" class="text-content"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-danger" id="delete-doc-btn">üóëÔ∏è Delete Document</button>
                    <button class="btn btn-secondary" id="reprocess-btn">üîÑ Re-process OCR</button>
                    <button class="btn btn-primary" id="save-text-btn" disabled>üíæ Save Changes</button>
                </div>
            </div>
        </div>

        <!-- Processing Modal -->
        <div id="processing-modal" class="modal hidden">
            <div class="modal-content processing-modal-content">
                <div class="processing-spinner"></div>
                <h3 id="processing-text">Processing...</h3>
                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill"></div>
                </div>
                <p id="progress-status">Initializing OCR engine...</p>
            </div>
        </div>

        <!-- Confirmation Modal -->
        <div id="confirm-modal" class="modal hidden">
            <div class="modal-content confirm-modal-content">
                <div class="confirm-icon">‚ö†Ô∏è</div>
                <h3 id="confirm-title">Confirm Action</h3>
                <p id="confirm-message">Are you sure you want to proceed?</p>
                <div class="confirm-actions">
                    <button class="btn btn-secondary" id="confirm-cancel-btn">Cancel</button>
                    <button class="btn btn-danger" id="confirm-ok-btn">Delete</button>
                </div>
            </div>
        </div>

        <!-- Toast Notifications -->
        <div id="toast-container" class="toast-container"></div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p>My Medical Details - Web-Based Document Scanner &amp; OCR | No installation required</p>
    </footer>
    </div><!-- End of app-container -->

    <!-- Tesseract.js Local -->
    <script src="vendor/tesseract.js/tesseract.min.js"></script>
    <!-- PDF.js Local for PDF support (ES Module) -->
    <script type="module">
        import * as pdfjsLib from './vendor/pdf.min.mjs';
        pdfjsLib.GlobalWorkerOptions.workerSrc = './vendor/pdf.worker.min.mjs';
        window.pdfjsLib = pdfjsLib;
    </script>
    <!-- Application Scripts -->
    <script src="js/auth.js"></script>
    <script src="js/db.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
